<div class="jumbotron w-50" > 
<h1>Edit location</h1>
<% location = Colin::Models::Location.active.find(params[:location_id]) %>
    <input hidden type="text" name="location_id" id="location_id" value="<%= params[:location_id] %>"/>
    <div class="form-group">
        <label for="parent_id">Parent location</label>
        <select class="form-control selectpicker" id="location_list" name="parent_id" title="Parent Location" data-live-search="true">      
        </select>
    </div>
    <div class="form-group">
    <label for="name">Name</label>
      <input type="text" name="name" placeholder="Name" value="<%= location.name %>" class="form-control"/>
    </div>
    <div class="form-group">
    <label for="barcode">Barcode</label>
      <input type="text" name="barcode" placeholder="Barcode" value="<%= location.barcode %>" class="form-control"/>
    </div>

    <div class="form-group">
        <label for="location_type_id">Location type</label>
        <select class="form-control selectpicker" id="location_type_id" name="location_type_id" title="Location Type">   
        <% Colin::Models::LocationType.all.each do |location_type| %>
          <option  <%= 'selected' if location.location_type_id == location_type.id %> value="<%= location_type.id %>"><%= location_type.name %></option>
        <% end %>  
      </select>
    </div>

    <div class="form-group">
        <label for="temperature">Temperature</label>
        <div class="input-group mb-3">
            <input type="text" class="form-control w-75" name="temperature" value="<%= location.temperature %>" placeholder="Temperature">
            <div class="input-group-append">
                <span class="input-group-text" id="basic-addon2">&#8451;</span>
            </div>
        </div>
    </div>

    <!--<div class="form-group">
    <input class="form-check-input" type="checkbox" value="true" name ="monitored" id="monitored">
    <label class="form-check-label" for="monitored">
      Monitored?
    </label>
    </div>-->
    <button class="btn btn-primary" id="update_location" >Update Location</button> 
    <button class="btn btn-secondary" id="cancel">Cancel</button>
    <button class="btn btn-danger" id="delete_location">Delete</button>

</div>

<script>
$(document).ready(function () {
  PopulateLocationList("#location_list");
  $("#update_location").click(function () {
    $.ajax({
      type: "PUT",
      url: "/api/location/id/" + $("[name=location_id]").val(),
      data: {
        parent_id: $("[name='parent_id']").val(),
        name: $("[name='name']").val(),
        barcode: $("[name='barcode']").val(),
        location_type_id: $("[name='location_type_id']").val(),
        temperature: $("[name='temperature']").val(),
        monitored: $("[name='monitored']").prop("checked")
      },
      dataType: "json",
      success: function () {window.location.href = "/";}
    });
  });
  $("#cancel").click(function () {window.location.href = "/";});
  $("#delete_location").click(function () {
    $.ajax({
      type: "DELETE",
      url: "/api/location/id/" + $("[name=location_id]").val(),
      dataType: "json",
      success: function () {window.location.href = "/";}
    });
  });
});
</script>